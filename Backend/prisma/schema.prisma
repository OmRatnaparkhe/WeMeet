generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}


model User {
  id String @id @default(cuid())
  clerkId String @unique
  name String?
  email String?

  meetings Meeting[] @relation("HostMeetings")
  participants Participant[]
  recordings Recording[]

  createdAt DateTime @default(now())
}

model Meeting {
  id String @id @default(cuid())
  roomId String @unique
  title String?
  hostId String
  host User @relation("HostMeetings", fields:[hostId], references:[id])
  participants Participant[]
  recordings Recording[]
  type MeetingType
  startedAt DateTime?
  endedAt DateTime?
  createdAt DateTime @default(now())
  scheduledAt DateTime

  micOn Boolean @default(true)
  camOn Boolean @default(true)
  autoRecord Boolean @default(false)
}

model Participant {
  id String @id @default(cuid())
  meetingId String
  userId String
  meeting Meeting @relation(fields:[meetingId], references:[id])
  user User @relation(fields:[userId], references:[id])

  joinedAt DateTime @default(now())
  leftAt DateTime?

  @@unique([meetingId, userId])
}

model Recording {
  id String @id @default(cuid())
  meetingId String
  userId String

  meeting Meeting @relation(fields:[meetingId], references:[id])
  user User @relation(fields:[userId], references:[id])
  type RecordingType
  fileKey String?
  durationSec Int?
  mimeType String?

  startedAt DateTime
  endedAt DateTime?
  createdAt DateTime @default(now())
}

enum RecordingType {
  CAMERA
  SCREEN
  AUDIO
  LOCAL
}

enum MeetingType {
  INSTANT
  SCHEDULED
}